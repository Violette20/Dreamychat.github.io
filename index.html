<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>HTML Editor - LDDGO.NET</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/styles/default.min.css" type="text/css">
</head>
<body>

<p>&lt;!DOCTYPE html&gt;<br />&lt;html lang="zh-CN"&gt;<br />&lt;head&gt;<br />&nbsp; &nbsp; &lt;meta charset="UTF-8"&gt;<br />&nbsp; &nbsp; &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;<br />&nbsp; &nbsp; &lt;title&gt;DreamyChat v5.0 ğŸ’&lt;/title&gt;<br />&nbsp; &nbsp; &lt;link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&amp;family=Zcool+KuaiLe&amp;display=swap" rel="stylesheet"&gt;<br />&nbsp; &nbsp; &lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"&gt;<br />&nbsp; &nbsp;&nbsp;<br />&nbsp; &nbsp; &lt;style&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; :root {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --primary-pink: #ff9a9e;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --soft-purple: #a18cd1;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --glass-bg: rgba(255, 255, 255, 0.92);&nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --text-color: #444;<br />&nbsp; &nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; * { margin: 0; padding: 0; box-sizing: border-box; }</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; body {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; font-family: 'Quicksand', sans-serif;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; height: 100vh;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; display: flex; justify-content: center; align-items: center;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; color: var(--text-color); overflow: hidden;<br />&nbsp; &nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; .main-container {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; width: 95%; max-width: 1200px; height: 95vh;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; background: var(--glass-bg);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; border-radius: 25px;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; box-shadow: 0 20px 60px rgba(0,0,0,0.15);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; display: flex; overflow: hidden;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; border: 1px solid #fff;<br />&nbsp; &nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; /* å·¦ä¾§æ  */<br />&nbsp; &nbsp; &nbsp; &nbsp; .sidebar {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; width: 320px; background: rgba(245,247,250,0.8);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; border-right: 1px solid rgba(0,0,0,0.05);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; display: flex; flex-direction: column;<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; .sidebar-header { padding: 20px; text-align: center; font-family: 'Zcool KuaiLe', cursive; font-size: 1.8rem; color: var(--soft-purple); }<br />&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; .char-list { flex: 1; overflow-y: auto; padding: 10px; }<br />&nbsp; &nbsp; &nbsp; &nbsp; .char-item {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; display: flex; align-items: center; gap: 10px; padding: 12px;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; border-radius: 12px; cursor: pointer; margin-bottom: 6px;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; transition: 0.2s; border: 2px solid transparent;<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; .char-item:hover { background: #fff; }<br />&nbsp; &nbsp; &nbsp; &nbsp; .char-item.active { background: #fff; border-color: var(--primary-pink); }<br />&nbsp; &nbsp; &nbsp; &nbsp; .char-avatar-sm { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; background: #ddd; }</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; .btn-group { padding: 15px; display: flex; flex-direction: column; gap: 10px; border-top: 1px solid rgba(0,0,0,0.05); }<br />&nbsp; &nbsp; &nbsp; &nbsp; .btn { padding: 12px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }<br />&nbsp; &nbsp; &nbsp; &nbsp; .btn-primary { background: var(--soft-purple); color: white; }<br />&nbsp; &nbsp; &nbsp; &nbsp; .btn-primary:hover { background: #8e7cc3; }<br />&nbsp; &nbsp; &nbsp; &nbsp; .btn-light { background: #fff; border: 1px solid #ddd; color: #666; }</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; /* ç¼–è¾‘é¢æ¿ */<br />&nbsp; &nbsp; &nbsp; &nbsp; .edit-panel {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; width: 0; background: #fff; transition: width 0.3s ease;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; overflow: hidden; border-right: 1px solid #eee; display: flex; flex-direction: column;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; z-index: 10;<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; .edit-panel.open { width: 350px; }<br />&nbsp; &nbsp; &nbsp; &nbsp; .edit-content { padding: 20px; overflow-y: auto; min-width: 350px; }<br />&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; .form-group { margin-bottom: 15px; }<br />&nbsp; &nbsp; &nbsp; &nbsp; .form-group label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 0.85rem; color: #666; }<br />&nbsp; &nbsp; &nbsp; &nbsp; .form-group input, .form-group textarea, .form-group select {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; background: #f9f9f9; outline: none; font-family: inherit;<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; .form-group textarea { height: 100px; resize: none; }<br />&nbsp; &nbsp; &nbsp; &nbsp; .avatar-preview { width: 100px; height: 100px; border-radius: 50%; margin: 0 auto 10px; display: block; object-fit: cover; border: 4px solid var(--primary-pink); }</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; /* èŠå¤©åŒº */<br />&nbsp; &nbsp; &nbsp; &nbsp; .chat-area { flex: 1; display: flex; flex-direction: column; background: rgba(255,255,255,0.5); }<br />&nbsp; &nbsp; &nbsp; &nbsp; .chat-header { padding: 15px 25px; background: rgba(255,255,255,0.8); display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(0,0,0,0.05); }<br />&nbsp; &nbsp; &nbsp; &nbsp; .header-avatar { width: 48px; height: 48px; border-radius: 12px; object-fit: cover; }<br />&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; #chat-box { flex: 1; padding: 20px 40px; overflow-y: auto; display: flex; flex-direction: column; gap: 20px; scroll-behavior: smooth; }<br />&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; .msg-row { display: flex; gap: 15px; max-width: 85%; animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }<br />&nbsp; &nbsp; &nbsp; &nbsp; @keyframes popIn { from { opacity: 0; transform: scale(0.9) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }<br />&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; .msg-row.user { align-self: flex-end; flex-direction: row-reverse; }<br />&nbsp; &nbsp; &nbsp; &nbsp; .msg-avatar { width: 42px; height: 42px; border-radius: 50%; object-fit: cover; flex-shrink: 0; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }<br />&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; .bubble {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; padding: 14px 18px; background: #fff; border-radius: 20px;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; border-top-left-radius: 4px; line-height: 1.6;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; box-shadow: 0 2px 8px rgba(0,0,0,0.03); font-size: 0.95rem; color: #333;<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; .msg-row.user .bubble { background: var(--primary-pink); color: white; border-top-left-radius: 20px; border-top-right-radius: 4px; }</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; .input-area { padding: 20px; background: #fff; display: flex; gap: 12px; align-items: center; border-top: 1px solid #eee; }<br />&nbsp; &nbsp; &nbsp; &nbsp; #user-input { flex: 1; padding: 15px; border-radius: 30px; border: 2px solid #eee; background: #f8f8f8; outline: none; }<br />&nbsp; &nbsp; &nbsp; &nbsp; #user-input:focus { border-color: var(--soft-purple); background: #fff; }<br />&nbsp; &nbsp; &nbsp; &nbsp; #send-btn { width: 54px; height: 54px; border-radius: 50%; border: none; background: var(--primary-pink); color: white; font-size: 1.3rem; cursor: pointer; transition: 0.2s; }<br />&nbsp; &nbsp; &nbsp; &nbsp; #send-btn:hover { transform: scale(1.1); }<br />&nbsp; &nbsp; &nbsp; &nbsp; #send-btn:disabled { background: #ddd; transform: none; cursor: wait; }</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; .hidden { display: none !important; }<br />&nbsp; &nbsp; &nbsp; &nbsp; .loader { border: 2px solid #f3f3f3; border-top: 2px solid var(--primary-pink); border-radius: 50%; width: 16px; height: 16px; animation: spin 1s linear infinite; display: inline-block; }<br />&nbsp; &nbsp; &nbsp; &nbsp; @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }<br />&nbsp; &nbsp; &lt;/style&gt;<br />&lt;/head&gt;<br />&lt;body&gt;</p>
<p>&lt;div class="main-container"&gt;<br />&nbsp; &nbsp; &lt;div class="sidebar"&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &lt;div class="sidebar-header"&gt;DreamyChat v5&lt;/div&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &lt;div class="char-list" id="char-list"&gt;&lt;/div&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &lt;div class="btn-group"&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button class="btn btn-primary" onclick="createNewChar()"&gt;&lt;i class="fas fa-plus"&gt;&lt;/i&gt; æ–°å»ºè§’è‰²&lt;/button&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button class="btn btn-light" onclick="toggleEditPanel('settings')"&gt;&lt;i class="fas fa-cog"&gt;&lt;/i&gt; å…¨å±€è®¾ç½®&lt;/button&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;<br />&nbsp; &nbsp; &lt;/div&gt;</p>
<p>&nbsp; &nbsp; &lt;div class="edit-panel" id="edit-panel"&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &lt;div id="settings-form" class="edit-content hidden"&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;h3 style="margin-bottom:15px; color:var(--soft-purple);"&gt;ğŸ“¡ è®¾ç½®&lt;/h3&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class="form-group"&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label&gt;API åœ°å€&lt;/label&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input type="text" id="api-url" value="https://api.openai.com/v1"&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class="form-group"&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label&gt;API Key&lt;/label&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input type="password" id="api-key" placeholder="sk-..."&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button class="btn btn-light" id="fetch-btn" onclick="fetchModels()" style="width:100%; margin-bottom:15px;"&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;span id="fetch-txt"&gt;ğŸ”— è·å–æ¨¡å‹åˆ—è¡¨&lt;/span&gt;&lt;div id="fetch-load" class="loader hidden"&gt;&lt;/div&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/button&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class="form-group"&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label&gt;æ¨¡å‹&lt;/label&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;select id="model-select"&gt;&lt;option value="gpt-3.5-turbo"&gt;gpt-3.5-turbo&lt;/option&gt;&lt;/select&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;hr style="border:0; border-top:1px dashed #ccc; margin:20px 0;"&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;img src="" class="avatar-preview" id="user-avatar-preview"&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class="form-group"&gt;&lt;label&gt;æˆ‘çš„å¤´åƒ&lt;/label&gt;&lt;input type="file" id="user-avatar-upload" accept="image/*"&gt;&lt;/div&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class="form-group"&gt;&lt;label&gt;æˆ‘çš„æ˜µç§°&lt;/label&gt;&lt;input type="text" id="user-name" value="æˆ‘"&gt;&lt;/div&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class="form-group"&gt;&lt;label&gt;æˆ‘çš„è®¾å®š&lt;/label&gt;&lt;textarea id="user-desc"&gt;æ™®é€šäººã€‚&lt;/textarea&gt;&lt;/div&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button class="btn btn-primary" style="width:100%" onclick="saveSettings()"&gt;ä¿å­˜è®¾ç½®&lt;/button&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button class="btn btn-light" style="width:100%; margin-top:10px; color:red;" onclick="hardReset()"&gt;âš ï¸ æ¸…ç©ºæ•°æ®&lt;/button&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &lt;div id="char-form" class="edit-content hidden"&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;h3 style="margin-bottom:15px; color:var(--soft-purple);"&gt;âœï¸ ç¼–è¾‘è§’è‰²&lt;/h3&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;img src="" class="avatar-preview" id="char-avatar-preview"&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class="form-group"&gt;&lt;label&gt;è§’è‰²å¤´åƒ&lt;/label&gt;&lt;input type="file" id="char-avatar-upload" accept="image/*"&gt;&lt;/div&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class="form-group"&gt;&lt;label&gt;è§’è‰²åå­—&lt;/label&gt;&lt;input type="text" id="edit-char-name"&gt;&lt;/div&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class="form-group"&gt;&lt;label&gt;è§’è‰²è®¾å®š (Prompt)&lt;/label&gt;&lt;textarea id="edit-char-prompt" style="height:150px;"&gt;&lt;/textarea&gt;&lt;/div&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class="form-group"&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label&gt;ğŸ’¬ æ°”æ³¡åˆ‡åˆ†æ¨¡å¼ (é˜²é•¿ç¯‡å¤§è®º)&lt;/label&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;select id="edit-char-split"&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value="off"&gt;å…³é—­ (å•æ°”æ³¡)&lt;/option&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value="auto"&gt;è‡ªåŠ¨åˆ‡åˆ† (æ¨èï¼åƒçœŸäººè¿å‘)&lt;/option&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/select&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;small style="color:#888; font-size:0.8rem;"&gt;* è‡ªåŠ¨åˆ‡åˆ†ä¼šå¼ºåˆ¶AIç”¨çŸ­å¥è¿å‘ï¼Œæ¯æ¬¡å›å¤ä¼šå¼¹å‡º 2-4 ä¸ªæ°”æ³¡ã€‚&lt;/small&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div style="display:flex; gap:10px;"&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button class="btn btn-primary" style="flex:1" onclick="saveChar()"&gt;ä¿å­˜&lt;/button&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button class="btn btn-light" style="flex:1; color:red;" onclick="deleteChar()"&gt;åˆ é™¤&lt;/button&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;<br />&nbsp; &nbsp; &lt;/div&gt;</p>
<p>&nbsp; &nbsp; &lt;div class="chat-area"&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &lt;div class="chat-header"&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div style="display:flex; align-items:center; gap:15px;"&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;img src="" class="header-avatar" id="header-avatar"&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div&gt;&lt;h2 id="header-name" style="font-size:1.1rem;"&gt;Name&lt;/h2&gt;&lt;/div&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button style="background:none; border:none; cursor:pointer; font-size:1.2rem; color:#666;" onclick="toggleEditPanel('char')"&gt;&lt;i class="fas fa-edit"&gt;&lt;/i&gt;&lt;/button&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button style="background:none; border:none; cursor:pointer; font-size:1.2rem; color:#666; margin-left:10px;" onclick="clearHistory()"&gt;&lt;i class="fas fa-trash-alt"&gt;&lt;/i&gt;&lt;/button&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &lt;div id="chat-box"&gt;&lt;/div&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &lt;div class="input-area"&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input type="text" id="user-input" placeholder="è¾“å…¥æ¶ˆæ¯..." autocomplete="off"&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button id="send-btn"&gt;&lt;i class="fas fa-paper-plane"&gt;&lt;/i&gt;&lt;/button&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;<br />&nbsp; &nbsp; &lt;/div&gt;<br />&lt;/div&gt;</p>
<p>&lt;script&gt;<br />&nbsp; &nbsp; // === å›¾ç‰‡å‹ç¼© (é˜²å¡é¡¿) ===<br />&nbsp; &nbsp; function compressImg(file, cb) {<br />&nbsp; &nbsp; &nbsp; &nbsp; const reader = new FileReader();<br />&nbsp; &nbsp; &nbsp; &nbsp; reader.readAsDataURL(file);<br />&nbsp; &nbsp; &nbsp; &nbsp; reader.onload = e =&gt; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const img = new Image();<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; img.src = e.target.result;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; img.onload = () =&gt; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const cvs = document.createElement('canvas');<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const scale = 150 / img.width;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cvs.width = 150; cvs.height = img.height * scale;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cvs.getContext('2d').drawImage(img,0,0,cvs.width,cvs.height);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cb(cvs.toDataURL('image/jpeg', 0.7));<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; // === æ•°æ®ç»“æ„ ===<br />&nbsp; &nbsp; const defAvt = "https://api.dicebear.com/7.x/avataaars/svg?seed=";<br />&nbsp; &nbsp; let data = {<br />&nbsp; &nbsp; &nbsp; &nbsp; settings: { url: "https://api.openai.com/v1", key: "", model: "gpt-3.5-turbo", name: "æˆ‘", desc: "", avatar: defAvt+"Me" },<br />&nbsp; &nbsp; &nbsp; &nbsp; chars: [{ id: 1, name: "Geminiè€å¸ˆ", avatar: defAvt+"Gem", prompt: "æ¸©æŸ”çš„AIåŠ©æ•™", splitMode: "auto", history: [] }],<br />&nbsp; &nbsp; &nbsp; &nbsp; activeId: 1<br />&nbsp; &nbsp; };</p>
<p>&nbsp; &nbsp; // === åˆå§‹åŒ– ===<br />&nbsp; &nbsp; function load() {<br />&nbsp; &nbsp; &nbsp; &nbsp; const local = localStorage.getItem('dreamy_v5');<br />&nbsp; &nbsp; &nbsp; &nbsp; if(local) data = JSON.parse(local);<br />&nbsp; &nbsp; &nbsp; &nbsp; renderList(); loadChar();<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; function save() { localStorage.setItem('dreamy_v5', JSON.stringify(data)); }<br />&nbsp; &nbsp; function hardReset() { if(confirm("æ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼Ÿ")) { localStorage.removeItem('dreamy_v5'); location.reload(); } }<br />&nbsp; &nbsp; load();</p>
<p>&nbsp; &nbsp; // === æ¸²æŸ“é€»è¾‘ ===<br />&nbsp; &nbsp; function renderList() {<br />&nbsp; &nbsp; &nbsp; &nbsp; const list = document.getElementById('char-list'); list.innerHTML = '';<br />&nbsp; &nbsp; &nbsp; &nbsp; data.chars.forEach(c =&gt; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const el = document.createElement('div');<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; el.className = `char-item ${c.id === data.activeId ? 'active' : ''}`;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; el.onclick = () =&gt; { data.activeId = c.id; save(); renderList(); loadChar(); document.getElementById('edit-panel').classList.remove('open'); };<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; el.innerHTML = `&lt;img src="${c.avatar}" class="char-avatar-sm"&gt;&lt;b&gt;${c.name}&lt;/b&gt;`;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; list.appendChild(el);<br />&nbsp; &nbsp; &nbsp; &nbsp; });<br />&nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; function loadChar() {<br />&nbsp; &nbsp; &nbsp; &nbsp; const c = data.chars.find(x =&gt; x.id === data.activeId);<br />&nbsp; &nbsp; &nbsp; &nbsp; document.getElementById('header-name').textContent = c.name;<br />&nbsp; &nbsp; &nbsp; &nbsp; document.getElementById('header-avatar').src = c.avatar;<br />&nbsp; &nbsp; &nbsp; &nbsp; const box = document.getElementById('chat-box'); box.innerHTML = '';<br />&nbsp; &nbsp; &nbsp; &nbsp; c.history.forEach(msg =&gt; addBubble(msg.role, msg.content, false));<br />&nbsp; &nbsp; &nbsp; &nbsp; box.scrollTop = 99999;<br />&nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; function addBubble(role, text, animate=true) {<br />&nbsp; &nbsp; &nbsp; &nbsp; const isUser = role === 'user';<br />&nbsp; &nbsp; &nbsp; &nbsp; const div = document.createElement('div');<br />&nbsp; &nbsp; &nbsp; &nbsp; div.className = `msg-row ${isUser ? 'user' : 'ai'}`;<br />&nbsp; &nbsp; &nbsp; &nbsp; if(!animate) div.style.animation = 'none';<br />&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; const avatar = isUser ? data.settings.avatar : document.getElementById('header-avatar').src;<br />&nbsp; &nbsp; &nbsp; &nbsp; div.innerHTML = `&lt;img src="${avatar}" class="msg-avatar"&gt;&lt;div class="bubble"&gt;${text.replace(/\n/g, '&lt;br&gt;')}&lt;/div&gt;`;<br />&nbsp; &nbsp; &nbsp; &nbsp; document.getElementById('chat-box').appendChild(div);<br />&nbsp; &nbsp; &nbsp; &nbsp; document.getElementById('chat-box').scrollTop = 99999;<br />&nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; // === ç¼–è¾‘é¢æ¿é€»è¾‘ ===<br />&nbsp; &nbsp; function toggleEditPanel(type) {<br />&nbsp; &nbsp; &nbsp; &nbsp; const p = document.getElementById('edit-panel');<br />&nbsp; &nbsp; &nbsp; &nbsp; const fs = document.getElementById('settings-form');<br />&nbsp; &nbsp; &nbsp; &nbsp; const fc = document.getElementById('char-form');<br />&nbsp; &nbsp; &nbsp; &nbsp; p.classList.add('open');<br />&nbsp; &nbsp; &nbsp; &nbsp; if(type === 'settings') {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fs.classList.remove('hidden'); fc.classList.add('hidden');<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const s = data.settings;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; document.getElementById('api-url').value = s.url;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; document.getElementById('api-key').value = s.key;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; document.getElementById('user-name').value = s.name;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; document.getElementById('user-desc').value = s.desc;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; document.getElementById('user-avatar-preview').src = s.avatar;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const sel = document.getElementById('model-select');<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if([...sel.options].every(o=&gt;o.value!==s.model)) sel.add(new Option(s.model, s.model));<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sel.value = s.model;<br />&nbsp; &nbsp; &nbsp; &nbsp; } else {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fs.classList.add('hidden'); fc.classList.remove('hidden');<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const c = data.chars.find(x =&gt; x.id === data.activeId);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; document.getElementById('edit-char-name').value = c.name;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; document.getElementById('edit-char-prompt').value = c.prompt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; document.getElementById('char-avatar-preview').src = c.avatar;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; document.getElementById('edit-char-split').value = c.splitMode || "off";<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; // ç»‘å®šä¸Šä¼ <br />&nbsp; &nbsp; ['user','char'].forEach(t =&gt; {<br />&nbsp; &nbsp; &nbsp; &nbsp; document.getElementById(`${t}-avatar-upload`).onchange = function() {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(this.files[0]) compressImg(this.files[0], res =&gt; document.getElementById(`${t}-avatar-preview`).src = res);<br />&nbsp; &nbsp; &nbsp; &nbsp; };<br />&nbsp; &nbsp; });</p>
<p>&nbsp; &nbsp; function saveSettings() {<br />&nbsp; &nbsp; &nbsp; &nbsp; const s = data.settings;<br />&nbsp; &nbsp; &nbsp; &nbsp; s.url = document.getElementById('api-url').value;<br />&nbsp; &nbsp; &nbsp; &nbsp; s.key = document.getElementById('api-key').value;<br />&nbsp; &nbsp; &nbsp; &nbsp; s.model = document.getElementById('model-select').value;<br />&nbsp; &nbsp; &nbsp; &nbsp; s.name = document.getElementById('user-name').value;<br />&nbsp; &nbsp; &nbsp; &nbsp; s.desc = document.getElementById('user-desc').value;<br />&nbsp; &nbsp; &nbsp; &nbsp; s.avatar = document.getElementById('user-avatar-preview').src;<br />&nbsp; &nbsp; &nbsp; &nbsp; save(); alert("å·²ä¿å­˜"); document.getElementById('edit-panel').classList.remove('open'); loadChar();<br />&nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; function saveChar() {<br />&nbsp; &nbsp; &nbsp; &nbsp; const c = data.chars.find(x =&gt; x.id === data.activeId);<br />&nbsp; &nbsp; &nbsp; &nbsp; c.name = document.getElementById('edit-char-name').value;<br />&nbsp; &nbsp; &nbsp; &nbsp; c.prompt = document.getElementById('edit-char-prompt').value;<br />&nbsp; &nbsp; &nbsp; &nbsp; c.avatar = document.getElementById('char-avatar-preview').src;<br />&nbsp; &nbsp; &nbsp; &nbsp; c.splitMode = document.getElementById('edit-char-split').value;<br />&nbsp; &nbsp; &nbsp; &nbsp; save(); alert("å·²ä¿å­˜"); document.getElementById('edit-panel').classList.remove('open'); renderList(); loadChar();<br />&nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; function createNewChar() {<br />&nbsp; &nbsp; &nbsp; &nbsp; const id = Date.now();<br />&nbsp; &nbsp; &nbsp; &nbsp; data.chars.push({ id, name:"æ–°è§’è‰²", avatar: defAvt+id, prompt:"...", splitMode:"auto", history:[] });<br />&nbsp; &nbsp; &nbsp; &nbsp; data.activeId = id; save(); renderList(); toggleEditPanel('char');<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; function deleteChar() {<br />&nbsp; &nbsp; &nbsp; &nbsp; if(data.chars.length&lt;=1) return alert("ä¸èƒ½åˆ é™¤æœ€åä¸€ä¸ªè§’è‰²");<br />&nbsp; &nbsp; &nbsp; &nbsp; if(confirm("åˆ é™¤ï¼Ÿ")) {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data.chars = data.chars.filter(x=&gt;x.id!==data.activeId);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data.activeId = data.chars[0].id; save(); renderList(); loadChar(); document.getElementById('edit-panel').classList.remove('open');<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; function clearHistory() {<br />&nbsp; &nbsp; &nbsp; &nbsp; if(confirm("æ¸…ç©ºèŠå¤©ï¼Ÿ")) { data.chars.find(x=&gt;x.id===data.activeId).history=[]; save(); loadChar(); }<br />&nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; // === API é€šä¿¡ (æ ¸å¿ƒå‡çº§) ===<br />&nbsp; &nbsp; async function fetchModels() {<br />&nbsp; &nbsp; &nbsp; &nbsp; const url = document.getElementById('api-url').value.replace(/\/$/,"") + (document.getElementById('api-url').value.includes("/v1")?"":"/v1");<br />&nbsp; &nbsp; &nbsp; &nbsp; const key = document.getElementById('api-key').value;<br />&nbsp; &nbsp; &nbsp; &nbsp; if(!key) return alert("è¯·è¾“å…¥Key");<br />&nbsp; &nbsp; &nbsp; &nbsp; document.getElementById('fetch-txt').classList.add('hidden');<br />&nbsp; &nbsp; &nbsp; &nbsp; document.getElementById('fetch-load').classList.remove('hidden');<br />&nbsp; &nbsp; &nbsp; &nbsp; try {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const res = await fetch(url+"/models", {headers:{Authorization:`Bearer ${key}`}});<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const d = await res.json();<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const sel = document.getElementById('model-select'); sel.innerHTML='';<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; d.data.sort((a,b)=&gt;a.id.localeCompare(b.id)).forEach(m =&gt; sel.add(new Option(m.id, m.id)));<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; alert(`æˆåŠŸåŠ è½½ ${d.data.length} ä¸ªæ¨¡å‹`);<br />&nbsp; &nbsp; &nbsp; &nbsp; } catch(e) { alert("å¤±è´¥: "+e.message); }<br />&nbsp; &nbsp; &nbsp; &nbsp; document.getElementById('fetch-txt').classList.remove('hidden');<br />&nbsp; &nbsp; &nbsp; &nbsp; document.getElementById('fetch-load').classList.add('hidden');<br />&nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; const uInput = document.getElementById('user-input');<br />&nbsp; &nbsp; const sBtn = document.getElementById('send-btn');<br />&nbsp; &nbsp; uInput.onkeypress = e =&gt; { if(e.key==='Enter') send(); };<br />&nbsp; &nbsp; sBtn.onclick = send;</p>
<p>&nbsp; &nbsp; async function send() {<br />&nbsp; &nbsp; &nbsp; &nbsp; const text = uInput.value.trim();<br />&nbsp; &nbsp; &nbsp; &nbsp; if(!text || !data.settings.key) return;<br />&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; const c = data.chars.find(x =&gt; x.id === data.activeId);<br />&nbsp; &nbsp; &nbsp; &nbsp; const userMsg = { role: "user", content: text };<br />&nbsp; &nbsp; &nbsp; &nbsp; c.history.push(userMsg);<br />&nbsp; &nbsp; &nbsp; &nbsp; addBubble("user", text);<br />&nbsp; &nbsp; &nbsp; &nbsp; save();<br />&nbsp; &nbsp; &nbsp; &nbsp; uInput.value = '';<br />&nbsp; &nbsp; &nbsp; &nbsp; sBtn.disabled = true;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; try {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let url = data.settings.url.replace(/\/$/, "");<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(!url.includes("/v1")) url += "/v1";</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // --- æ ¸å¿ƒ Prompt å‡çº§ï¼šé˜²æ“æ§ + å¼ºåˆ¶åˆ†æ®µ ---<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let sysPrompt = `<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; You are playing a roleplay game.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Your character: "${c.name}". Description: ${c.prompt}.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; User character: "${data.settings.name}". Description: ${data.settings.desc}.</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [ABSOLUTE RULES]:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1. NEVER describe the User's actions, thoughts, or dialogue. Only describe YOUR OWN (${c.name}).<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2. If the user performs an action, you must react to it, but DO NOT act for them.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3. Reply in Chinese.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; `;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // å¦‚æœå¼€å¯äº†è‡ªåŠ¨åˆ‡åˆ†ï¼Œæ³¨å…¥åˆ‡åˆ†æŒ‡ä»¤<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (c.splitMode === "auto") {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sysPrompt += `<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4. [IMPORTANT] Split your response into 2-4 short separate parts using the symbol "|||".<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Example: (Light laugh) Interesting. ||| But you know the rules. ||| (Leans closer) Are you sure?<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Each part should be a distinct bubble.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; `;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const res = await fetch(url + "/chat/completions", {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; method: 'POST',<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${data.settings.key}` },<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; body: JSON.stringify({<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; model: data.settings.model,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; messages: [{role:"system", content:sysPrompt}, ...c.history.slice(-10)],<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; temperature: 0.8<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; })<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; });</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const d = await res.json();<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(d.error) throw new Error(d.error.message);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let reply = d.choices[0].message.content;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // --- åå¤„ç†ï¼šæ£€æµ‹åˆ‡åˆ†ç¬¦å¹¶æ¨¡æ‹Ÿè¿å‘ ---<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (reply.includes("|||")) {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const parts = reply.split("|||").map(p =&gt; p.trim()).filter(p =&gt; p);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (let i = 0; i &lt; parts.length; i++) {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // ä¿å­˜å®Œæ•´å†å²ï¼ˆä¸ºäº†ä¸Šä¸‹æ–‡è¿è´¯ï¼Œå­˜å®Œæ•´çš„ï¼‰<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(i===0) c.history.push({ role: "assistant", content: reply.replace(/\|\|\|/g, " ") });<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // è§†è§‰ä¸Šåˆ†å¼€å‘é€<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; addBubble("assistant", parts[i]);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // æ¨¡æ‹Ÿæ‰“å­—å»¶è¿Ÿ<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (i &lt; parts.length - 1) await new Promise(r =&gt; setTimeout(r, 800 + Math.random() * 500));<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // æ²¡æœ‰è§¦å‘åˆ‡åˆ†ï¼Œæ­£å¸¸å‘é€<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c.history.push({ role: "assistant", content: reply });<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; addBubble("assistant", reply);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; save();</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; } catch(e) {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; addBubble("assistant", "âŒ é”™è¯¯: " + e.message);<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; sBtn.disabled = false;<br />&nbsp; &nbsp; }<br />&lt;/script&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;</p>

<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js" type="text/javascript"></script>
<script type="text/javascript">hljs.highlightAll();</script>
</body>
</html>